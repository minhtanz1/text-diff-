<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextDiff 95 - Advanced Comparison Tool</title>
    
    <!-- Added Fonts: Tahoma for UI, JetBrains Mono for Code -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Tahoma:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Added highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        :root {
            --bg-color: #c0c0c0;
            --shadow-light: #ffffff;
            --shadow-dark: #808080;
            --text-color: #000000;
            --title-bar-bg-start: #000080;
            --title-bar-bg-end: #0000A0;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --accent-grey: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tahoma', sans-serif;
            background: #008080; /* Classic Teal wallpaper */
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            font-size: 11px;
        }
        
        .window {
            background: var(--bg-color);
            border-top: 2px solid var(--shadow-light);
            border-left: 2px solid var(--shadow-light);
            border-right: 2px solid var(--shadow-dark);
            border-bottom: 2px solid var(--shadow-dark);
            box-shadow: 2px 2px 0px black, inset 1px 1px 0px var(--shadow-light);
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .title-bar {
            background: linear-gradient(90deg, var(--title-bar-bg-start) 0%, var(--title-bar-bg-end) 100%);
            color: white;
            padding: 4px 8px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .window-controls { display: flex; gap: 2px; }
        .window-control {
            width: 16px; height: 14px; background: var(--bg-color);
            border-top: 1px solid var(--shadow-light); border-left: 1px solid var(--shadow-light);
            border-right: 1px solid var(--shadow-dark); border-bottom: 1px solid var(--shadow-dark);
            font-size: 10px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .window-control:active {
            border-top: 1px solid var(--shadow-dark); border-left: 1px solid var(--shadow-dark);
            border-right: 1px solid var(--shadow-light); border-bottom: 1px solid var(--shadow-light);
        }
        
        .toolbar {
            background: var(--bg-color);
            border-bottom: 1px solid var(--shadow-dark);
            padding: 6px 8px;
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn, .file-label {
            background: var(--bg-color);
            border-top: 1px solid var(--shadow-light); border-left: 1px solid var(--shadow-light);
            border-right: 1px solid var(--shadow-dark); border-bottom: 1px solid var(--shadow-dark);
            padding: 5px 12px;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            color: var(--text-color);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn:hover, .file-label:hover { background: #d0d0d0; }
        .btn:active, .file-label:active {
            border-top: 1px solid var(--shadow-dark); border-left: 1px solid var(--shadow-dark);
            padding: 6px 11px 4px 13px; /* Simulates press */
        }
        .btn.active {
            background: #e0e0e0;
            border-top: 1px solid var(--shadow-dark); border-left: 1px solid var(--shadow-dark);
        }
        .btn:disabled {
            color: var(--shadow-dark);
            text-shadow: 1px 1px 0 var(--shadow-light);
            cursor: not-allowed;
        }
        
        .separator { width: 1px; height: 20px; background: var(--shadow-dark); border-right: 1px solid var(--shadow-light); margin: 0 4px; }
        
        .input-section { display: flex; background: var(--bg-color); }
        .input-panel {
            flex: 1; display: flex; flex-direction: column;
            border-right: 1px solid var(--shadow-dark);
        }
        .input-panel:last-child { border-right: none; }
        .panel-header {
            padding: 4px 8px; font-weight: bold;
            border-bottom: 1px solid var(--shadow-dark);
            background: #d0d0d0;
        }
        .text-input {
            flex: 1; font-family: 'JetBrains Mono', monospace; font-size: 13px;
            border: 1px solid var(--shadow-dark);
            border-right-color: var(--shadow-light); border-bottom-color: var(--shadow-light);
            margin: 4px; padding: 4px; resize: none; background: white;
            min-height: 200px;
        }
        
        .stats {
            margin: 8px; padding: 8px;
            border: 1px solid var(--shadow-dark);
            border-right-color: var(--shadow-light); border-bottom-color: var(--shadow-light);
        }
        
        .diff-output {
            background: white;
            border: 1px solid var(--shadow-dark);
            border-right-color: var(--shadow-light); border-bottom-color: var(--shadow-light);
            margin: 8px; padding: 0;
            font-family: 'JetBrains Mono', monospace; font-size: 13px;
            overflow: auto; min-height: 350px;
        }

        .diff-split-view { display: flex; }
        .diff-pane { flex: 1; min-width: 50%; }
        .diff-pane:first-child { border-right: 1px solid #ddd; }
        
        .diff-line {
            display: flex;
            padding: 0 8px;
            white-space: pre-wrap; /* Allow long lines to wrap */
            word-break: break-all;
            line-height: 1.5;
            border-top: 1px solid transparent; /* for high-contrast border */
            border-bottom: 1px solid transparent; /* for high-contrast border */
        }
        .diff-line:hover { background-color: #f1f8ff; }

        .diff-line.added { background-color: #e6ffed; }
        .diff-line.removed { background-color: #ffeef0; }
        .diff-line.placeholder { background-color: #f8f9fa; }

        .line-numbers {
            flex: 0 0 80px;
            user-select: none;
            color: rgba(27,31,35,.3);
            text-align: right;
            padding-right: 10px;
        }
        .line-content { flex: 1; }
        .line-content.added::before { content: '+'; padding-right: 8px; color: var(--accent-green); }
        .line-content.removed::before { content: '-'; padding-right: 8px; color: var(--accent-red); }

        .current-change {
            outline: 2px solid #0366d6;
            outline-offset: -2px;
        }
        
        .status-bar {
            background: var(--bg-color);
            border-top: 1px solid var(--shadow-dark);
            padding: 4px 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .file-input { display: none; }
        
        @keyframes blink { 50% { opacity: 0; } }
        .processing { animation: blink 1s step-end infinite; }
    </style>
</head>
<body>
    <div class="window">
        <div class="title-bar">
            <span>üìÑ TextDiff 95 - Advanced Comparison Tool</span>
            <div class="window-controls">
                <div class="window-control">_</div><div class="window-control">‚ñ°</div><div class="window-control">√ó</div>
            </div>
        </div>
        
        <div class="toolbar">
            <button class="btn" onclick="compareTexts()">üîç Compare</button>
            <button class="btn" onclick="clearAll()">üóëÔ∏è Clear</button>
            <div class="separator"></div>
            <label for="file1" class="file-label">üìÇ Load Original... <span id="file1-name" style="font-style: italic; color: #555; margin-left: 5px;"></span></label>
            <input type="file" id="file1" class="file-input" onchange="loadFile(1, this)">
            <label for="file2" class="file-label">üìÇ Load Modified... <span id="file2-name" style="font-style: italic; color: #555; margin-left: 5px;"></span></label>
            <input type="file" id="file2" class="file-input" onchange="loadFile(2, this)">
            <div class="separator"></div>
            <button class="btn" id="prevBtn" onclick="prevChange()" disabled>‚ñ≤ Prev</button>
            <button class="btn" id="nextBtn" onclick="nextChange()" disabled>‚ñº Next</button>
            <div class="separator"></div>
            <button class="btn active" id="unifiedBtn" onclick="setView('unified')">üìÑ Unified</button>
            <button class="btn" id="splitBtn" onclick="setView('split')">üìë Split</button>
        </div>
        
        <div class="input-section">
            <div class="input-panel">
                <div class="panel-header">Original Text (File 1)</div>
                <textarea id="text1" class="text-input" placeholder="Paste original text here..."></textarea>
            </div>
            <div class="input-panel">
                <div class="panel-header">Modified Text (File 2)</div>
                <textarea id="text2" class="text-input" placeholder="Paste modified text here..."></textarea>
            </div>
        </div>
        
        <div class="stats" id="stats">
            üìä Ready to compare.
        </div>
        
        <div class="diff-output" id="diffOutput">
            <div style="padding: 20px; text-align: center; color: #666;">
                Welcome to TextDiff 95!<br><br>
                Enter text above or load files, then click 'Compare' to see the differences.
            </div>
        </div>
        
        <div class="status-bar">
            <span id="statusText">Ready</span>
            <span>¬© 1995 RetroSoft Inc.</span>
        </div>
    </div>

    <script>
        // --- State Variables ---
        let diffResult = [];
        let diffStats = { added: 0, removed: 0 };
        let currentChangeIndex = -1;
        let changeElements = [];
        let currentView = 'unified'; // 'unified' or 'split'

        // --- DOM Elements ---
        const text1El = document.getElementById('text1');
        const text2El = document.getElementById('text2');
        const diffOutputEl = document.getElementById('diffOutput');
        const statusTextEl = document.getElementById('statusText');
        const statsEl = document.getElementById('stats');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const unifiedBtn = document.getElementById('unifiedBtn');
        const splitBtn = document.getElementById('splitBtn');
        
        // --- Core Functions ---

        function loadFile(fileNumber, input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(`text${fileNumber}`).value = e.target.result;
                document.getElementById(`file${fileNumber}-name`).textContent = `(${file.name})`;
                updateStatus(`Loaded file: ${file.name}`);
                // Auto-compare if the other pane has text
                if (text1El.value && text2El.value) compareTexts();
            };
            reader.readAsText(file);
        }

        function clearAll() {
            text1El.value = '';
            text2El.value = '';
            document.getElementById('file1-name').textContent = '';
            document.getElementById('file2-name').textContent = '';
            diffOutputEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Cleared! Enter new text to compare.</div>';
            statsEl.innerHTML = 'üìä Ready to compare.';
            resetNav();
            updateStatus('Cleared all content');
        }
        
        function compareTexts() {
            updateStatus('Processing...');
            statusTextEl.classList.add('processing');
            
            // Use setTimeout to allow UI to update before blocking
            setTimeout(() => {
                const text1 = text1El.value;
                const text2 = text2El.value;
                
                // Using a more robust Longest Common Subsequence based diff algorithm
                diffResult = diffLcs(text1.split('\n'), text2.split('\n'));
                
                diffStats.added = diffResult.filter(d => d.added).length;
                diffStats.removed = diffResult.filter(d => d.removed).length;

                renderDiff();
                
                statusTextEl.classList.remove('processing');
                updateStatus('Comparison complete');
            }, 50); // Short delay is enough
        }

        function renderDiff() {
            if (currentView === 'unified') {
                displayUnifiedDiff(diffResult);
            } else {
                displaySplitDiff(diffResult);
            }
            updateStats();
            setupNav();
            // Apply syntax highlighting
            diffOutputEl.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
        }

        // --- Diff Algorithm (LCS-based) ---
        function diffLcs(oldLines, newLines) {
            const a = oldLines;
            const b = newLines;
            const matrix = Array(a.length + 1).fill(0).map(() => Array(b.length + 1).fill(0));

            for (let i = 1; i <= a.length; i++) {
                for (let j = 1; j <= b.length; j++) {
                    if (a[i - 1] === b[j - 1]) {
                        matrix[i][j] = matrix[i - 1][j - 1] + 1;
                    } else {
                        matrix[i][j] = Math.max(matrix[i - 1][j], matrix[i][j - 1]);
                    }
                }
            }

            const result = [];
            let i = a.length, j = b.length;
            while (i > 0 || j > 0) {
                if (i > 0 && j > 0 && a[i - 1] === b[j - 1]) {
                    result.unshift({ value: a[i - 1], added: false, removed: false, lineA: i, lineB: j });
                    i--; j--;
                } else if (j > 0 && (i === 0 || matrix[i][j - 1] >= matrix[i - 1][j])) {
                    result.unshift({ value: b[j - 1], added: true, removed: false, lineB: j });
                    j--;
                } else if (i > 0 && (j === 0 || matrix[i][j - 1] < matrix[i - 1][j])) {
                    result.unshift({ value: a[i - 1], added: false, removed: true, lineA: i });
                    i--;
                }
            }
            return result;
        }

        // --- Display Functions ---

        function displayUnifiedDiff(diff) {
            if (diffStats.added === 0 && diffStats.removed === 0) {
                diffOutputEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No differences found!</div>';
                return;
            }

            let html = '';
            diff.forEach(part => {
                const type = part.added ? 'added' : (part.removed ? 'removed' : 'unchanged');
                const lineA = part.lineA || '';
                const lineB = part.lineB || '';

                html += `
                    <div class="diff-line ${type}">
                        <div class="line-numbers">${String(lineA).padStart(4)} ${String(lineB).padStart(4)}</div>
                        <pre class="line-content ${type}"><code class="language-diff">${escapeHtml(part.value)}</code></pre>
                    </div>`;
            });
            diffOutputEl.innerHTML = `<div class="diff-unified-view">${html}</div>`;
        }

        function displaySplitDiff(diff) {
            if (diffStats.added === 0 && diffStats.removed === 0) {
                diffOutputEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No differences found!</div>';
                return;
            }
            
            let leftHtml = '';
            let rightHtml = '';
            let lineA = 1, lineB = 1;

            diff.forEach(part => {
                const escapedValue = `<pre><code class="language-diff">${escapeHtml(part.value)}</code></pre>`;
                if (part.added) {
                    leftHtml += `<div class="diff-line placeholder"><div class="line-numbers"></div><div class="line-content"></div></div>`;
                    rightHtml += `<div class="diff-line added"><div class="line-numbers">${lineB++}</div><div class="line-content added">${escapedValue}</div></div>`;
                } else if (part.removed) {
                    leftHtml += `<div class="diff-line removed"><div class="line-numbers">${lineA++}</div><div class="line-content removed">${escapedValue}</div></div>`;
                    rightHtml += `<div class="diff-line placeholder"><div class="line-numbers"></div><div class="line-content"></div></div>`;
                } else {
                    leftHtml += `<div class="diff-line"><div class="line-numbers">${lineA++}</div><div class="line-content">${escapedValue}</div></div>`;
                    rightHtml += `<div class="diff-line"><div class="line-numbers">${lineB++}</div><div class="line-content">${escapedValue}</div></div>`;
                }
            });

            diffOutputEl.innerHTML = `
                <div class="diff-split-view">
                    <div class="diff-pane">${leftHtml}</div>
                    <div class="diff-pane">${rightHtml}</div>
                </div>`;
        }
        
        // --- UX / Navigation ---

        function setView(view) {
            currentView = view;
            unifiedBtn.classList.toggle('active', view === 'unified');
            splitBtn.classList.toggle('active', view === 'split');
            if (diffResult.length > 0) {
                renderDiff();
            }
        }
        
        function setupNav() {
            changeElements = Array.from(diffOutputEl.querySelectorAll('.diff-line.added, .diff-line.removed'));
            currentChangeIndex = -1;
            if (changeElements.length > 0) {
                nextBtn.disabled = false;
                prevBtn.disabled = true;
            } else {
                resetNav();
            }
        }
        
        function resetNav() {
            changeElements = [];
            currentChangeIndex = -1;
            nextBtn.disabled = true;
            prevBtn.disabled = true;
            statusTextEl.textContent = 'Ready';
        }

        function nextChange() {
            if (currentChangeIndex < changeElements.length - 1) {
                currentChangeIndex++;
                highlightChange();
            }
        }

        function prevChange() {
            if (currentChangeIndex > 0) {
                currentChangeIndex--;
                highlightChange();
            }
        }

        function highlightChange() {
            changeElements.forEach(el => el.classList.remove('current-change'));
            const currentEl = changeElements[currentChangeIndex];
            currentEl.classList.add('current-change');
            currentEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Update buttons state
            prevBtn.disabled = currentChangeIndex === 0;
            nextBtn.disabled = currentChangeIndex === changeElements.length - 1;
            
            // Update status
            updateStatus(`Viewing change ${currentChangeIndex + 1} of ${changeElements.length}`);
        }

        // --- Helpers ---
        
        function updateStatus(message) {
            statusTextEl.textContent = message;
        }

        function updateStats() {
            statsEl.innerHTML = `
                üìä <strong>Comparison Results:</strong> 
                <span style="color: var(--accent-green);">+${diffStats.added} added</span> | 
                <span style="color: var(--accent-red);">-${diffStats.removed} removed</span>
            `;
        }
        
        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
